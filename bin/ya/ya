#!/usr/bin/env bash

#
# Примеси
#

ya---() {
    "$YA" "$@"
}

ya-compdb() {
    ya make -r --add-protobuf-result --force-build-depends "$@"
    ya dump compile-commands -r "$@" > compile_commands.json
}

ya-tool---() {
    ya -- tool "$@"
}

ya-tool() {
    if declare -F ya-tool-$1 > /dev/null; then
        ya-tool-"$@"
    else
        ya tool -- "$@"
    fi
}

ya-tool-cs() {
    # Не очень понятно, зачем вообще было ограничивать количество совпадений и
    # длину выводимых строк, если вывод `cs` будет отсматриваться `grep`'ом,
    # `fzf`'ом или чем-то похожим
    ya tool -- cs -g inf -m inf -t -W $((2 ** 32 - 1)) "$@"
}

ya-tool-gdb() {
    ya tool -- gdb -iex "set auto-load safe-path /" "$@"
}

#
# Точка входа
#

ya() {
    if declare -F ya-$1 > /dev/null; then
        ya-"$@"
        return
    fi

    ya -- "$@"
}

export YA=$(which -a ya | grep -v "$(realpath "$0")" | head -1)
if [[ -z "$YA" ]]; then
    echo "ya: command not found"
    echo "Consider visiting documentation page at 'https://docs.yandex-team.ru/devtools/intro/quick-start-guide' for more details"
    exit 1
fi

ya "$@"
